<UserControl x:Class="WPFTemplate.CornerPasswordBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WPFTemplate"
             mc:Ignorable="d"  d:DesignHeight="30" d:DesignWidth="300" 
             UseLayoutRounding="True" BorderBrush="#FFABAdB3" BorderThickness="1" Background="White">
    <UserControl.Resources>
        <SolidColorBrush x:Key="TextBox.Static.Border" Color="#FFABAdB3"/>
        <SolidColorBrush x:Key="TextBox.MouseOver.Border" Color="#FF7EB4EA"/>
        <SolidColorBrush x:Key="TextBox.Focus.Border" Color="#FF569DE5"/>
        <local:TextLengthIsNullOrEmptyToTrue x:Key="TextLengthIsNullOrEmptyToTrue"/>
        <Style x:Key="passwordstyle1" TargetType="{x:Type PasswordBox}" BasedOn="{StaticResource {x:Type PasswordBox}}">
            <Setter Property="PasswordChar" Value="●"/>
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>
            <Setter Property="BorderBrush" Value="{StaticResource TextBox.Static.Border}"/>
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="KeyboardNavigation.TabNavigation" Value="None"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="AllowDrop" Value="true"/>
            <Setter Property="ScrollViewer.PanningMode" Value="VerticalFirst"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type PasswordBox}">
                        <Border x:Name="border" SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Opacity" TargetName="border" Value="0.56"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource TextBox.MouseOver.Border}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource TextBox.Focus.Border}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <MultiTrigger>
                    <MultiTrigger.Conditions>
                        <Condition Property="IsInactiveSelectionHighlightEnabled" Value="true"/>
                        <Condition Property="IsSelectionActive" Value="false"/>
                    </MultiTrigger.Conditions>
                    <Setter Property="SelectionBrush" Value="{DynamicResource {x:Static SystemColors.InactiveSelectionHighlightBrushKey}}"/>
                </MultiTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <UserControl.Template>
        <ControlTemplate TargetType="UserControl">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                </Grid.ColumnDefinitions>
                <Border x:Name="PART_Border" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" 
                        Background="{TemplateBinding Background}" Grid.ColumnSpan="3" AllowDrop="False"
                        CornerRadius="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=CornerRadius}">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="4" Color="Transparent" ShadowDepth="0" RenderingBias="Performance"/>
                    </Border.Effect>
                </Border>
                <Grid Grid.Column="1" x:Name="PART_Grid">
                    <TextBlock x:Name="tbWatermark" IsHitTestVisible="False" VerticalAlignment="Center" Opacity="0.4" Margin="3,0,0,0"
                                Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=Watermark}"/>
                    <TextBlock x:Name="tbShowPassword" IsHitTestVisible="False" VerticalAlignment="Center" Margin="3,0,0,0" Visibility="Collapsed"
                                Text="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=Password}"/>
                    <PasswordBox x:Name="passwordBox" Style="{StaticResource ResourceKey=passwordstyle1}" PasswordChanged="PasswordBox_PasswordChanged" Grid.Column="1"
                             HorizontalAlignment="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=HorizontalAlignment}"
                             VerticalAlignment="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=VerticalAlignment}"
                             HorizontalContentAlignment="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=HorizontalContentAlignment}"
                             VerticalContentAlignment="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=local:CornerPasswordBox}, Path=VerticalContentAlignment}"/>
                </Grid>
                <Viewbox x:Name="eyebox" Height="10" Grid.Column="2">
                    <Viewbox.RenderTransform>
                        <TranslateTransform X="0" Y="-1"/>
                    </Viewbox.RenderTransform>
                    <Grid>
                        <Path Stroke="Black" StrokeThickness="25"
                                  Data="M512.02048 128q69.67296 0 135.49568 21.17632t115.5072 55.00928 93.4912 74.83392 73.66656 82.00192 51.67104 74.83392 32.17408 54.82496l9.99424 21.34016q-2.33472 4.99712-6.32832 13.49632t-18.8416 34.67264-31.66208 51.67104-44.3392 60.0064-56.832 64.32768-69.50912 60.17024-82.3296 51.5072-94.84288 34.67264-107.33568 13.49632q-69.67296 0-135.49568-21.17632t-115.5072-54.82496-93.4912-74.3424-73.66656-81.48992-51.67104-74.50624-32.17408-55.00928l-9.99424-20.992q2.33472-4.99712 6.32832-13.49632t18.8416-34.83648 31.66208-51.83488 44.3392-60.33408 56.832-64.67584 69.50912-60.33408 82.3296-51.83488 94.84288-34.83648 107.33568-13.49632zM512.02048 213.34016q-46.67392 0-91.66848 12.32896t-81.16224 31.82592-70.67648 47.16544-59.65824 54.49728-48.82432 57.67168-37.66272 52.8384-26.33728 43.99104q12.32896 21.66784 26.33728 43.49952t37.66272 52.3264 48.82432 56.99584 59.65824 53.84192 70.67648 46.67392 81.16224 31.49824 91.66848 12.16512 91.66848-12.32896 81.16224-31.66208 70.67648-46.83776 59.65824-54.1696 48.82432-57.32352 37.66272-52.67456 26.33728-43.66336q-12.32896-21.66784-26.33728-43.66336t-37.66272-52.67456-48.82432-57.32352-59.65824-54.1696-70.67648-46.83776-81.16224-31.66208-91.66848-12.32896zM512.02048 341.34016q70.67648 0 120.66816 49.99168t49.99168 120.66816-49.99168 120.66816-120.66816 49.99168-120.66816-49.99168-49.99168-120.66816 49.99168-120.66816 120.66816-49.99168zM512.02048 426.65984q-35.328 0-60.33408 25.00608t-25.00608 60.33408 25.00608 60.33408 60.33408 25.00608 60.33408-25.00608 25.00608-60.33408-25.00608-60.33408-60.33408-25.00608z"/>
                        <Rectangle Fill="Transparent"/>
                    </Grid>
                </Viewbox>
                <Viewbox x:Name="keybox" Height="10" Grid.Column="0">
                    <Viewbox.RenderTransform>
                        <TranslateTransform X="0" Y="-1"/>
                    </Viewbox.RenderTransform>
                    <Path Stroke="Black" StrokeThickness="25" 
                                  Data="M1056 128H96C42.98 128 0 170.98 0 224v576c0 53.02 42.98 96 96 96h960c53.02 0 96-42.98 96-96V224c0-53.02-42.98-96-96-96z m16 672c0 8.822-7.178 16-16 16H96c-8.822 0-16-7.178-16-16V224c0-8.822 7.178-16 16-16h960c8.822 0 16 7.178 16 16v576zM340 540v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m-672 164v-56c0-13.254-10.746-24-24-24H164c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m768 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24zM244 376v-56c0-13.254-10.746-24-24-24H164c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m192 0v-56c0-13.254-10.746-24-24-24h-56c-13.254 0-24 10.746-24 24v56c0 13.254 10.746 24 24 24h56c13.254 0 24-10.746 24-24z m-196 316v-32c0-13.254-10.746-24-24-24H360c-13.254 0-24 10.746-24 24v32c0 13.254 10.746 24 24 24h432c13.254 0 24-10.746 24-24z"/>
                </Viewbox>
            </Grid>
            <ControlTemplate.Triggers>
                <Trigger SourceName="eyebox" Property="IsMouseOver" Value="True">
                    <Setter TargetName="tbShowPassword" Property="Visibility" Value="Visible"/>
                    <Setter TargetName="passwordBox" Property="Visibility" Value="Hidden"/>
                    <Setter TargetName="tbWatermark" Property="Visibility" Value="Hidden"/>
                </Trigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=ShowWatermark}" Value="false">
                    <Setter Property="Visibility" TargetName="tbWatermark" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=Password, Converter={StaticResource TextLengthIsNullOrEmptyToTrue}}" Value="false">
                    <Setter Property="Visibility" TargetName="tbWatermark" Value="Collapsed"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=ShowIcon}" Value="false">
                    <Setter TargetName="keybox" Property="Visibility" Value="Collapsed"/>
                    <Setter TargetName="PART_Grid" Property="Grid.Column" Value="0"/>
                    <Setter TargetName="PART_Grid" Property="Grid.ColumnSpan" Value="2"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=ShowVisibleButton}" Value="false">
                    <Setter TargetName="eyebox" Property="Visibility" Value="Collapsed"/>
                </DataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
    </UserControl.Template>
</UserControl>
